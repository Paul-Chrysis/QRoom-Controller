<h1>AR Scene</h1>

<script>
  // Initialize token from URL parameter if present
  document.addEventListener('DOMContentLoaded', function() {
    // Listen for token updates from TokenService
    document.addEventListener('tokenUpdated', function(e) {
      console.log('Token updated event received');
      // You could update UI elements or reload data here if needed
    });
    
    // Debug info
    console.log('Scene loaded. Token in URL: ' + (new URLSearchParams(window.location.search).get('token') ? 'Yes' : 'No'));
  });
</script>

<a-scene renderer="antialias: false; logarithmicDepthBuffer:true" arjs='sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 4x4_BCH_13_9_3; emitevents:true;'>
  
  <%@markers.count.times do |index|%>
  <a-marker id="themarker" type='barcode' value='<%=index+1%>' data-controller="marker" data-marker-target="marker" markerhandler>
      <a-gui-flex-container
          id="panel<%=index+1%>"
          flex-direction="column" justify-content="center" align-items="normal" component-padding="0.1"
          opacity="0.7" width="3" height="3" panel-color="#fff" panel-rounded="0.1"
          position="0 0 0" rotation="-90 0 0"
          data-marker-target="container"
        ></a-gui-flex-container>
  </a-marker>
  <%end%>


  <a-entity camera="fov:40" id="cam">
  </a-entity>
</a-scene> 
<div id="dynamic-container" data-marker-target="container"></div>
